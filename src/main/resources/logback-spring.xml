<?xml version="1.0" encoding="UTF-8"?>
<configuration>
  <springProperty name="filePath" source="logging.file.path"/>

  <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
    <withJansi>true</withJansi>
    <encoder>
      <pattern>%black(%d{yyyy-MM-dd HH:mm:ss.SSS}) %highlight([%-5level]) %green({%thread}) trace_id=%X{trace_id} %magenta(%C{1}.%M[%file:%line]) - %msg %n</pattern>
    </encoder>
  </appender>

  <appender name="APP" class="ch.qos.logback.core.rolling.RollingFileAppender">
    <file>${filePath}/slogging-api.log</file>
    <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
      <fileNamePattern>${filePath}/slogging-api.%d{yyyy-MM-dd}.%i.gz</fileNamePattern>
      <timeBasedFileNamingAndTriggeringPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP">
        <maxFileSize>10MB</maxFileSize>
      </timeBasedFileNamingAndTriggeringPolicy>
      <maxHistory>10</maxHistory>
    </rollingPolicy>
    <encoder>
      <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%-5level] {%thread} trace_id=%X{trace_id} %C{1}.%M[%file:%line] - %msg %n</pattern>
    </encoder>
  </appender>

  <appender name="ERROR" class="ch.qos.logback.core.rolling.RollingFileAppender">
    <file>${filePath}/slogging-api-error.log</file>
    <filter class="ch.qos.logback.classic.filter.LevelFilter">
      <level>ERROR</level>
      <onMatch>ACCEPT</onMatch>
      <onMismatch>DENY</onMismatch>
    </filter>
    <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
      <fileNamePattern>${filePath}/slogging-api-error-%d{yyyy-MM-dd}.%i.gz</fileNamePattern>
      <timeBasedFileNamingAndTriggeringPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP">
        <maxFileSize>10MB</maxFileSize>
      </timeBasedFileNamingAndTriggeringPolicy>
      <maxHistory>30</maxHistory>
    </rollingPolicy>
    <encoder>
      <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%-5level] {%thread} trace_id=%X{trace_id} %C{1}.%M[%file:%line] - %msg %n</pattern>
    </encoder>
  </appender>

  <!-- TODO JSON 로그 의존성 확인 후 추가해보자 -->
  <!--
  <appender name="APP_JSON" class="ch.qos.logback.core.rolling.RollingFileAppender">
		<file>${filePath}/slogging-api-json.log</file>
		<rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
			<fileNamePattern>${filePath}/slogging-api-json.%d{yyyy-MM-dd}.%i.gz</fileNamePattern>
			<timeBasedFileNamingAndTriggeringPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP">
        <maxFileSize>10MB</maxFileSize>
      </timeBasedFileNamingAndTriggeringPolicy>
      <maxHistory>10</maxHistory>
		</rollingPolicy>
		<encoder class="ch.qos.logback.core.encoder.LayoutWrappingEncoder"> 
      <layout class="ch.qos.logback.contrib.json.classic.JsonLayout"> 
        <timestampFormat>yyyy-MM-dd'T'HH:mm:ss.SSSX</timestampFormat> 
        <timestampFormatTimezoneId>Asia/Seoul</timestampFormatTimezoneId> 
        <appendLineSeparator>true</appendLineSeparator> 
        <jsonFormatter class="ch.qos.logback.contrib.jackson.JacksonJsonFormatter"> 
          <prettyPrint>false</prettyPrint> 
        </jsonFormatter> 
      </layout> 
    </encoder>
	</appender>
  -->

  <!-- Spring -->
  <logger name="org.springframework.core" level="INFO" />
  <logger name="org.springframework.beans" level="INFO" />
  <logger name="org.springframework.context" level="INFO" />
  <logger name="org.springframework.web" level="INFO" />
  <logger name="org.springframework.cache.ehcache" level="INFO" />
  <!-- Database -->
  <logger name="org.apache.ibatis" level="OFF" />
  <logger name="org.mybatis.spring" level="DEBUG" />
  <logger name="org.springframework.jdbc" level="DEBUG" />
  <logger name="jdbc" level="OFF" />
  <logger name="jdbc.sqlonly" level="OFF" />
  <logger name="jdbc.sqltiming" level="DEBUG" />
  <logger name="jdbc.audit" level="OFF" />
  <logger name="jdbc.resultset" level="OFF" />
  <logger name="jdbc.resultsettable" level="DEBUG" />
  <logger name="jdbc.connection" level="OFF" />
  <logger name="log4jdbc.debug" level="DEBUG" />
  <!-- Service -->
  <logger name="io.vicevil4" level="DEBUG" />

  <root level="DEBUG">
    <appender-ref ref="CONSOLE"/>
    <appender-ref ref="APP"/>
    <appender-ref ref="ERROR"/>
  </root>
</configuration>